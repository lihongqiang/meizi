<link rel="stylesheet" type="text/css" href="css/jquery.dataTables.css">
<!--<link rel="stylesheet" type="text/css" href="css/dataTables.bootstrap.css">-->

<!-- jQuery -->
<!--<script type="text/javascript" charset="utf8" src="js/jquery.js"></script>-->
<!--<script type="text/javascript" charset="utf8" src="js/dataTables.bootstrap.js"></script>-->

<!-- DataTables -->
<script type="text/javascript" charset="utf8" src="js/jquery.dataTables.js"></script>

<link href="minimal/minimal.css" rel="stylesheet">
<script src="js/icheck.js"></script>




<script type="text/javascript">
//    $(document).ready(function(){
//        $('#upload_data').DataTable();
//    });
    $(document).ready(function(){
        var table = $('#upload_data').DataTable({
//            ajax: "http://localhost:8080/data-source",
            ajax: "http://162.105.16.229:9921/data-source",
            columns:[
                { data: 'upload'},
                { data: 'title'},
//                { data: 'upload_time' },
//                { data: 'duration' },
                { data: 'price_type' },
                { data: 'price' },
                { data: 'copyright_type' },
                { data: 'copyright_duration' },
            ],
            columnDefs: [
                {
                    "targets": 0,
                    "orderable": false,
                    "data": "upload",
                    "render": function ( data, type, full, meta ) {
                        return '<input type="checkbox" name="checkItem"  value=data>';
                    }
                },
                {
                    "targets": 2,
                    "orderable": false,
                    "data": "price_type",
                    "render": function ( data, type, full, meta) {
                        return '<select class="form-control"> \
                                <option>单价（元/秒）</option> \
                                <option>一口价</option> \
                                </select>';
                    }
                },
                {
                    "targets": 3,
                    "orderable": false,
                    "data": "price",
                    "render": function ( data, type, full, meta) {
                        return '<input type="text" class="form-control" placeholder="价格">';
                    }
                },
                {
                    "targets": 4,
                    "orderable": false,
                    "data": "copyright_type",
                    "render": function ( data, type, full, meta) {
                        return '<select class="form-control"> \
                                <option>RF</option> \
                                <option>RM</option> \
                                </select>';
                    }
                },
                {
                    "targets": 5,
                    "orderable": false,
                    "data": "copyright_duration",
                    "render": function ( data, type, full, meta) {
                        return '<select class="form-control"> \
                                <option>6个月</option> \
                                <option>一年</option> \
                                <option>两年</option> \
                                <option>三年</option> \
                                <option>五年</option> \
                                <option>长期</option> \
                                </select>';
                    }
                }
            ],
            //第一列排序图标改为默认
            order: [
                [0, null]
            ]
        });

//        $('input').iCheck({
//            checkboxClass: 'icheckbox_minimal',
//            radioClass: 'iradio_minimal',
//            increaseArea: '20%' // optional
//        });
//        table.draw();

        //全选
        $('input.checkAll').on('click', function() {
            if ($(this).prop("checked") === true) {
//                $("input").iCheck('check');
                $("input[name='checkItem']").prop("checked", $(this).prop("checked"));
                $('#upload_data tbody tr').addClass('selected');
            } else {
//                $("input").iCheck('uncheck');
                $("input[name='checkItem']").prop("checked", false);
                $('#upload_data tbody tr').removeClass('selected');
            }
        });

        //单选
        $('#upload_data tbody').on('click', 'tr input[name="checkItem"]', function () {
            var $tr = $(this).parents('tr');
            $tr.toggleClass('selected');
            var $tmp = $('[name=checkItem]:checkbox');
            $('#checkAll').prop('checked', $tmp.length == $tmp.filter(':checked').length);
        });

        $('#button').click(function () {
            var rows = table.rows('.selected');
            rows.every( function ( rowIdx, tableLoop, rowLoop ) {
                var d = this.data();
                console.log(d);
                $.ajax({
                    type: "post",
                    url: '/upload',
                    async: true, // 使用同步方式
                    // 1 需要使用JSON.stringify 否则格式为 a=2&b=3&now=14...
                    // 2 需要强制类型转换，否则格式为 {"a":"2","b":"3"}
                    data: JSON.stringify(d),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function(data) {
//                    $('#result').text(data.result);
                    } // 注意不要在此行增加逗号
                });
                this.invalidate(); // invalidate the data DataTables has cached for this row
            } );
//            angular.element(document.getElementById('app')).scope().upload(rows.data());
//            http =new XMLHttpRequest();
//            http.open("POST", "/upload", true);
//            http.send(rows.data());
//            controller.upload(rows.data());
            rows.remove().draw(false);
        });
    });

</script>

<!--<script>-->
    <!--$(function(){-->
        <!--$('input').iCheck({-->
            <!--checkboxClass: 'icheckbox_minimal',-->
            <!--radioClass: 'iradio_minimal',-->
            <!--increaseArea: '20%' // optional-->
        <!--});-->
    <!--});-->
<!--</script>-->

<!--<script>-->
    <!--$(function () {-->
        <!--var checkAll = $('input.checkAll');-->
        <!--checkAll.on('ifChecked ifUnchecked', function(event) {-->
            <!--if (event.type == 'ifChecked') {-->
                <!--$("input").iCheck('check');-->
            <!--} else {-->
                <!--$("input").iCheck('uncheck');-->
            <!--}-->
        <!--});-->
    <!--});-->
<!--</script>-->

<div ng-show="authenticated">
    <!--<h1>接入服务器</h1>-->
	<!--<p>The ID is {{controller.greeting.id}}</p>-->
	<!--<p>The content is {{controller.greeting.content}}</p>-->

    <h2 class="sub-header">上传信息</h2>
    <div class="table-responsive">
        <table id="upload_data" class="table table-striped table-condensed display">
            <thead>
            <tr>
                <th><input type="checkbox" id="checkAll" class="checkAll"/></th>
                <th>上传名称</th>
                <!--<th>上传时间</th>-->
                <!--<th>时长</th>-->
                <!--<th>内容简介</th>-->
                <th>价格类型</th>
                <th>单价</th>
                <th>版权类型</th>
                <th>版权期限</th>
                <!--<th><input type="checkbox" id="checkAll" class="checkAll"/></th>-->
            </tr>
            </thead>

        </table>
    </div>
    <div style="text-align:center;margin:0 auto;">
        <button class="btn btn-default" id="button" >上传</button>
    </div>


</div>
<div  ng-show="!authenticated">
    <div class="container">

        <!-- Main component for a primary marketing message or call to action -->
        <div class="jumbotron">
            <h1>接入服务器</h1>
            <p></p>
            <p>
                <a class="btn btn-lg btn-primary" href="http://www.baidu.com" role="button">媒资平台 &raquo;</a>
            </p>
        </div>

    </div> <!-- /container -->
    <footer>
        <p>&copy; 2016 Company, Inc.</p>
    </footer>
</div>


